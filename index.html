<!DOCTYPE html>. 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Trading</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header>
        <div class="header-main">
            <div class="api-status api-connecting" id="apiStatus">
                <span>●</span> Connecting...
            </div>
            <button class="wallet-btn" id="walletBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/>
                    <path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/>
                    <path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/>
                </svg>
            </button>
        </div>
    </header>

    <div class="main-container">
        <div class="chart-section px-3" id="chartSection">
            <div class="chart-slider" id="chartSlider">
                
                <div class="portfolio-view">
                    <div class="doughnut-container">
                        <canvas id="portfolioChart"></canvas>
                        <div class="doughnut-center">
                            <p class="text-xs text-slate-400 mb-1 font-medium">Total</p>
                            <p class="text-xl font-bold" id="total-value">$0</p>
                            <p class="text-xs text-blue-400 mt-1 font-semibold" id="asset-count">0 assets</p>
                        </div>
                    </div>
                    <p class="text-xs text-slate-500 mt-2 font-medium">Tap coin to trade</p>
                </div>
                
                <div class="trading-view" id="tradingView">
                    
                    <div class="trade-header-compact">
                        <div class="header-left">
                            <button class="back-btn" onclick="UI.closeTradingView()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                    <path d="m15 18-6-6 6-6"/>
                                </svg>
                            </button>
                            <div class="coin-mini">
                                <div class="coin-icon-tiny" id="tradeIcon" style="background: #f9731633; color: #f97316;">₿</div>
                                <span id="tradeName">BTC</span>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <button class="chart-toggle-btn" id="chartToggleBtn" onclick="UI.toggleMiniChart()" title="Toggle Chart">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 3v18h18"/>
                                    <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                                </svg>
                            </button>
                            
                            <div class="header-actions">
                                <button class="action-btn-mini sell" id="sellBtn" onclick="Trading.prepareTrade('sell')">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                        <path d="M5 12h14"/>
                                    </svg>
                                    Sell
                                </button>
                                <button class="action-btn-mini buy" id="buyBtn" onclick="Trading.prepareTrade('buy')">
                                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                        <path d="M12 5v14M5 12h14"/>
                                    </svg>
                                    Buy
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mini-chart-container" id="miniChartContainer">
                        <div class="mini-chart-box">
                            <canvas id="miniChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="order-toggle">
                        <button class="order-btn active" id="btnInstant" onclick="UI.setOrderType('instant')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                            </svg>
                            Instant
                        </button>
                        <button class="order-btn" id="btnTrigger" onclick="UI.setOrderType('trigger')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 2v4M12 18v4M2 12h4M18 12h4"/>
                            </svg>
                            Trigger
                        </button>
                        <button class="order-btn" id="btnAuto" onclick="UI.setOrderType('auto')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v4M12 18v4M2 12h4M18 12h4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                            </svg>
                            Auto
                        </button>
                    </div>
                    
                    <!-- AMOUNT SECTION - For Instant orders -->
                    <div class="amount-compact" id="amountSection">
                        <div class="cash-toggle">
                            <button class="cash-option active" id="optAUD" onclick="UI.setCash('AUD')">
                                <div class="icon" style="background: #f59e0b20; color: #f59e0b;">A$</div>
                                <span class="currency-name">AUD</span>
                                <span class="balance">$377.00</span>
                            </button>
                            <button class="cash-option" id="optUSDC" onclick="UI.setCash('USDC')">
                                <div class="icon" style="background: #22c55e20; color: #22c55e;">$</div>
                                <span class="currency-name">USDC</span>
                                <span class="balance">$498.00</span>
                            </button>
                        </div>

                        <div class="amount-display">
                            <div class="amount-value" id="amountValue">$0.00</div>
                            <div class="amount-conversion" id="conversionText">≈ 0 BTC</div>
                        </div>
                        
                        <div class="slider-box">
                            <div class="slider-track"></div>
                            <div class="slider-fill" id="amountFill" style="width: 0%;"></div>
                            <input type="range" id="amountSlider" min="0" max="100" value="0" step="1" oninput="UI.updateAmountSlider(this.value)">
                        </div>
                        <div class="slider-labels">
                            <span>0%</span>
                            <span id="amountPercent">0%</span>
                            <span>100%</span>
                        </div>
                    </div>
                    
                    <!-- TRIGGER SECTION - Updated with Buy Limit / Sell Limit buttons -->
                    <div class="trigger-compact" id="triggerSection">
                        <div class="trigger-header">
                            <span class="trigger-title">Trigger Price</span>
                            <span class="trigger-reset" onclick="Trading.resetTrigger()">Reset</span>
                        </div>
                        
                        <!-- AUD and USDC buttons with balances -->
                        <div class="cash-toggle">
                            <button class="cash-option active" id="triggerOptAUD" onclick="Trading.setTriggerCash('AUD')">
                                <div class="icon" style="background: #f59e0b20; color: #f59e0b;">A$</div>
                                <span class="currency-name">AUD</span>
                                <span class="balance">$377.00</span>
                            </button>
                            <button class="cash-option" id="triggerOptUSDC" onclick="Trading.setTriggerCash('USDC')">
                                <div class="icon" style="background: #22c55e20; color: #22c55e;">$</div>
                                <span class="currency-name">USDC</span>
                                <span class="balance">$498.00</span>
                            </button>
                        </div>
                        
                        <!-- Buy Limit / Sell Limit buttons -->
                        <div class="limit-toggle">
                            <button class="limit-btn buy-limit active" id="btnBuyLimit" onclick="Trading.setLimitType('buy')">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 5v14M5 12h14"/>
                                </svg>
                                Buy Limit
                            </button>
                            <button class="limit-btn sell-limit" id="btnSellLimit" onclick="Trading.setLimitType('sell')">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M5 12h14"/>
                                </svg>
                                Sell Limit
                            </button>
                        </div>
                        
                        <div class="trigger-price-row">
                            <div class="trigger-price" id="triggerPrice">$0.00</div>
                            <div class="trigger-offset" id="triggerOffset">+0%</div>
                        </div>
                        
                        <div id="triggerGuide" style="text-align: center; margin-bottom: 6px; font-size: 11px; color: #64748b;">
                            Set trigger relative to current price
                        </div>
                        
                        <div id="triggerError" class="error-message" style="display: none; margin-bottom: 6px;"></div>
                        
                        <div class="slider-box">
                            <div class="slider-track"></div>
                            <div class="slider-fill" id="triggerFill" style="width: 50%; background: #64748b;"></div>
                            <input type="range" id="triggerSlider" min="-20" max="20" value="0" step="1" oninput="Trading.updateTriggerSlider(this.value)">
                        </div>
                        <div class="slider-labels" id="triggerLabels">
                            <span>-20%</span>
                            <span>Current</span>
                            <span>+20%</span>
                        </div>
                    </div>
                    
                    <!-- AUTO SECTION - unchanged -->
                    <div class="auto-compact" id="autoSection">
                        <div class="auto-header">
                            <span class="auto-title">Auto Trade Settings</span>
                            <span class="auto-reset" onclick="Trading.resetAutoTrade()">Reset</span>
                        </div>
                        
                        <div style="margin-bottom: 10px;">
                            <div class="auto-price-row">
                                <div class="auto-price" id="autoPrice">$0.00</div>
                                <div class="auto-deviation" id="autoDeviation">0%</div>
                            </div>
                            
                            <div id="autoGuide" style="text-align: center; margin-bottom: 6px; font-size: 11px; color: #64748b;">
                                <span id="autoGuideText">Set price deviation</span>
                            </div>
                            
                            <div id="autoError" class="error-message" style="display: none; margin-bottom: 6px;"></div>
                            
                            <div class="slider-box">
                                <div class="slider-track"></div>
                                <div class="slider-fill" id="autoDevFill" style="width: 50%; background: #a855f7;"></div>
                                <input type="range" id="autoDevSlider" min="-20" max="20" value="0" step="1" oninput="Trading.updateAutoDevSlider(this.value)">
                            </div>
                            <div class="slider-labels" id="autoDevLabels">
                                <span>-20%</span>
                                <span>Current</span>
                                <span>+20%</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 12px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.05);">
                            <div class="auto-allocation-row">
                                <span class="auto-allocation-label">Portfolio Allocation</span>
                                <span class="auto-allocation-value" id="autoAllocationValue">0% of 0 AUD</span>
                            </div>
                            
                            <div class="slider-box">
                                <div class="slider-track"></div>
                                <div class="slider-fill" id="autoAllocFill" style="width: 0%; background: #22c55e;"></div>
                                <input type="range" id="autoAllocSlider" min="0" max="100" value="0" step="1" oninput="Trading.updateAutoAllocSlider(this.value)">
                            </div>
                            <div class="slider-labels">
                                <span>0%</span>
                                <span id="autoAllocPercent">0%</span>
                                <span>100%</span>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
            </div>
        </div>

        <div class="holdings-container" id="holdingsContainer">
            <div class="holdings-header">
                <h2 class="text-lg font-bold">Holdings</h2>
                <button onclick="UI.toggleSort()" class="sort-btn">
                    <span id="currentSortLabel">Sort: Value</span>
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m6 9 6 6 6-6"/>
                    </svg>
                </button>
            </div>
            
            <div id="holdings-list">
                <div style="text-align: center; color: #64748b; padding: 40px;">
                    Connecting to Swyftx...
                </div>
            </div>
            
            <div class="last-updated" id="last-updated">Last updated: --</div>
            
            <div class="card" style="margin-top: 20px;">
                <div class="section-title">Activity Log</div>
                <div id="log-container" class="log-container">
                    <div class="log-entry">
                        <span class="log-time">[--:--:--]</span>
                        <span class="log-info">Initializing...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sort Modal -->
    <div class="modal-overlay" id="sortModalOverlay" onclick="UI.toggleSort()"></div>
    <div class="sort-modal" id="sortModal">
        <h3 style="margin: 0 0 16px 0; font-size: 16px;">Sort Holdings</h3>
        <div style="display: flex; flex-direction: column; gap: 8px;">
            <button onclick="UI.setSort('value')" style="padding: 12px; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; color: white; cursor: pointer;">By Value (High to Low)</button>
            <button onclick="UI.setSort('name')" style="padding: 12px; background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #94a3b8; cursor: pointer;">By Name (A-Z)</button>
            <button onclick="UI.setSort('change')" style="padding: 12px; background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 8px; color: #94a3b8; cursor: pointer;">By 24h Change</button>
        </div>
    </div>

    <!-- Trade Confirmation Modal -->
    <div class="trade-modal-overlay" id="tradeModal">
        <div class="trade-modal-content">
            <div class="trade-modal-title" id="tradeModalTitle">Confirm Trade</div>
            <div class="trade-modal-details" id="tradeModalDetails"></div>
            <div class="trade-modal-buttons">
                <button class="trade-modal-btn cancel" onclick="Trading.cancelTrade()">Cancel</button>
                <button class="trade-modal-btn confirm" id="tradeModalConfirm" onclick="Trading.confirmTrade()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- PIN Modal -->
    <div class="pin-modal-overlay" id="pinModal">
        <div class="pin-modal-content">
            <div class="pin-title">Enter PIN</div>
            <div class="pin-subtitle">Please enter your 4-digit PIN to continue</div>
            <input type="password" class="pin-input" id="pinInput" maxlength="4" placeholder="••••">
            <button class="pin-btn" id="pinBtn" onclick="Trading.verifyPin()">Unlock</button>
            <div class="pin-error" id="pinError">Invalid PIN</div>
        </div>
    </div>

    <script src="js/script.js"></script>
</body>
</html>
