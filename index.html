
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>FLUB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="css/styles.css?v=20260220h">
</head>
<body class="pb-20">

<header>
    <div class="header-main">
        <div id="api-status" class="api-status api-connecting">
            <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
            Connecting...
        </div>
        <div style="font-size:10px;color:#666;position:absolute;top:2px;right:8px;">v7.5</div>
        <div style="display:flex; align-items:center; gap:8px;">
            <button onclick="PhantomWallet.isConnected ? PhantomWallet.toggleWalletPanel() : PhantomWallet.connect()" class="phantom-btn" id="phantomBtn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                <span id="phantomBtnText">Connect</span>
            </button>
            <button onclick="App.refreshData()" class="wallet-btn" id="refreshBtn">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"/>
                    <path d="M3 5v14a2 2 0 0 0 2 2h16v-5"/>
                    <path d="M18 12a2 2 0 0 0 0 4h4v-4Z"/>
                </svg>
            </button>
        </div>
    </div>
</header>

<div class="main-container">
    
    <div class="chart-section px-3" id="chartSection">
        <div class="chart-slider" id="chartSlider">
            
            <div class="portfolio-view">
                <div class="doughnut-container">
                    <canvas id="portfolioChart"></canvas>
                    <div class="doughnut-center">
                        <p class="text-xs text-slate-400 mb-1 font-medium" id="chartLabel">Total</p>
                        <p class="text-xl font-bold" id="total-value">$0</p>
                        <p class="text-xs text-blue-400 mt-1 font-semibold" id="asset-count">0 assets</p>
                    </div>
                </div>
                <!-- Swipe indicator dots -->
                <div id="chartDots" style="display:none;text-align:center;margin-top:4px;">
                    <span id="dot-user" style="display:inline-block;width:8px;height:8px;border-radius:50%;background:#3b82f6;margin:0 3px;transition:all 0.2s;cursor:pointer;"></span>
                    <span id="dot-pool" style="display:inline-block;width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,0.2);margin:0 3px;transition:all 0.2s;cursor:pointer;"></span>
                </div>
                <p class="text-xs text-slate-500 mt-1 font-medium" id="portfolioHint">Tap coin to trade</p>

                <!-- Admin quick-nav buttons -->
                <div class="admin-only" id="adminQuickNav">
                    <button onclick="UI.quickNav('instant')">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                        Instant
                    </button>
                    <button onclick="UI.quickNav('trigger')">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="3"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/></svg>
                        Trigger
                    </button>
                    <button onclick="UI.quickNav('auto')">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2v4M12 18v4M2 12h4M18 12h4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                        Auto
                    </button>
                </div>

                <!-- Cash balances: admin sees USDC+AUD, user sees deposited USDC -->
                <div class="cash-balances-header admin-only" style="margin-top:8px;justify-content:center;">
                    <div class="cash-balance-item">
                        <div class="cash-dot usdc-dot"></div>
                        <span class="cash-label">USDC</span>
                        <span class="cash-amount" id="headerUsdcBalance">$0.00</span>
                    </div>
                    <div class="cash-balance-item">
                        <div class="cash-dot aud-dot"></div>
                        <span class="cash-label">AUD</span>
                        <span class="cash-amount" id="headerAudBalance">$0.00</span>
                    </div>
                </div>

                <!-- User deposited + wallet balance (user-only) -->
                <div class="user-only" id="userDepositedBanner" style="display:none;margin-top:6px;text-align:center;">
                    <div style="display:inline-flex;align-items:center;gap:8px;padding:5px 14px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);border-radius:20px;flex-wrap:nowrap;">
                        <span style="font-size:11px;color:#64748b;">Deposited</span>
                        <span style="font-size:12px;font-weight:700;color:#22c55e;" id="userDepositedAmount">$0.00</span>
                        <span style="width:1px;height:12px;background:rgba(255,255,255,0.1);"></span>
                        <span style="font-size:11px;color:#64748b;">Wallet</span>
                        <span style="font-size:12px;font-weight:700;color:#ab9ff2;" id="userWalletUsdc">$0.00</span>
                    </div>
                    <div id="lowWalletWarning" style="display:none;margin-top:5px;">
                        <a href="#" onclick="UI.showDepositModal();return false;" style="display:inline-flex;align-items:center;gap:4px;padding:4px 12px;background:rgba(234,179,8,0.1);border:1px solid rgba(234,179,8,0.2);border-radius:16px;font-size:11px;color:#eab308;text-decoration:none;font-weight:600;">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14M5 12h14"/></svg>
                            Deposit More Funds
                        </a>
                    </div>
                </div>

                <!-- ═══ User Insight Cards (read-only) ═══ -->
                <div class="user-only user-insight-cards" id="userInsightCards" style="display:none;">
                    <div class="insight-card pending-card" onclick="UI.showUserPendingOrders()">
                        <div class="insight-card-icon pending-icon">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                        </div>
                        <div class="insight-card-body">
                            <div class="insight-card-title">Orders</div>
                            <div class="insight-card-value" id="userPendingCount">None</div>
                        </div>
                    </div>
                    <div class="insight-card bot-card" onclick="UI.showUserAutoTrader()">
                        <div class="insight-card-icon bot-icon">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v4M12 18v4M2 12h4M18 12h4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                            </svg>
                        </div>
                        <div class="insight-card-body">
                            <div class="insight-card-title">Auto Trader</div>
                            <div class="insight-card-value" id="userBotStatus">Inactive</div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="trading-view" id="tradingView">
                
                <div class="trade-header-compact">
                    <div class="header-left">
                        <button class="back-btn" onclick="UI.closeTradingView()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                <path d="m15 18-6-6 6-6"/>
                            </svg>
                        </button>
                        <div class="coin-mini" onclick="UI.openCoinSelector()" style="cursor:pointer;">
                            <div class="coin-icon-tiny" id="tradeIcon" style="background: #f9731633; color: #f97316;">₿</div>
                            <span id="tradeName">BTC</span>
                            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" style="opacity:0.5;margin-left:-2px;"><path d="m6 9 6 6 6-6"/></svg>
                        </div>
                    </div>
                    <button class="chart-toggle-btn" id="chartToggleBtn" onclick="UI.toggleMiniChart()" title="Toggle Chart">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v18h18"/>
                            <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                        </svg>
                    </button>
                </div>
                
                <div class="mini-chart-container" id="miniChartContainer">
                    <div class="mini-chart-box">
                        <canvas id="miniChart"></canvas>
                    </div>
                </div>
                
                <div class="order-toggle">
                    <button class="order-btn active" id="btnInstant" onclick="UI.setOrderType('instant')">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                        </svg>
                        Instant
                    </button>
                    <button class="order-btn" id="btnTrigger" onclick="UI.setOrderType('trigger')">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 2v4M12 18v4M2 12h4M18 12h4"/>
                        </svg>
                        Trigger
                    </button>
                    <button class="order-btn admin-only" id="btnAuto" onclick="UI.setOrderType('auto')">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2v4M12 18v4M2 12h4M18 12h4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/>
                        </svg>
                        Auto
                    </button>
                </div>
                
                <div class="amount-compact" id="amountSection">
                    <!-- Buy / Sell toggle -->
                    <div class="instant-side-toggle" id="instantSideToggle">
                        <button class="instant-side-btn buy active" id="instantBuyBtn" onclick="UI.setInstantSide('buy')">Buy</button>
                        <button class="instant-side-btn sell" id="instantSellBtn" onclick="UI.setInstantSide('sell')">Sell</button>
                    </div>

                    <!-- Balance context -->
                    <div class="instant-balance-info" id="instantBalanceInfo">
                        Available: <span id="instantAvailable">$0.00 USDC</span>
                    </div>

                    <div class="amount-display">
                        <div class="amount-value" id="amountValue">$0.00</div>
                        <div class="amount-conversion" id="conversionText">≈ 0 BTC</div>
                    </div>

                    <div class="slider-box">
                        <div class="slider-track"></div>
                        <div class="slider-fill" id="amountFill" style="width: 0%;"></div>
                        <input type="range" id="amountSlider" min="0" max="100" value="0" step="1" oninput="UI.updateAmountSlider(this.value)">
                    </div>
                    <div class="slider-labels">
                        <span>0%</span>
                        <span id="amountPercent">0%</span>
                        <span>100%</span>
                    </div>

                    <!-- Confirm button -->
                    <button class="instant-confirm-btn buy" id="instantConfirmBtn" onclick="Trading.prepareTrade(State.pendingTradeSide || 'buy')">
                        <span id="instantConfirmText">Confirm Buy</span>
                    </button>
                </div>
                
                                <div class="trigger-compact" id="triggerSection">
                    <div class="trigger-header">
                        <span class="trigger-title">Trigger Order</span>
                        <span class="trigger-reset" onclick="Trading.resetTrigger()">Reset</span>
                    </div>

                    <!-- Step 1: Choose direction -->
                    <div class="limit-toggle" id="limitButtons">
                        <button class="limit-btn buy-limit" id="btnBuyLimit" onclick="Trading.selectLimitType('buy')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
                            Buy Dip
                        </button>
                        <button class="limit-btn sell-limit" id="btnSellLimit" onclick="Trading.selectLimitType('sell')">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/></svg>
                            Sell Rise
                        </button>
                    </div>

                    <!-- Step 2: Configure (shown after direction chosen) -->
                    <div class="hidden" id="triggerConfig">

                        <!-- Direction badge & price in one row -->
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                            <div class="trigger-direction-badge" id="triggerDirectionBadge" style="margin-bottom:0;">Buy Dip</div>
                            <div style="display:flex;align-items:center;gap:6px;">
                                <div class="trigger-price" style="font-size:20px;" id="triggerPrice">$0.00</div>
                                <div class="trigger-offset" id="triggerOffset">+0%</div>
                            </div>
                        </div>

                        <!-- Two sliders side by side -->
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
                            
                            <!-- Price slider -->
                            <div>
                                <div style="font-size:11px;color:#64748b;margin-bottom:4px;text-align:center;">Price</div>
                                <div class="slider-box" style="height:32px;">
                                    <div class="slider-track"></div>
                                    <div class="slider-fill" id="triggerFill" style="width:50%;background:#64748b;"></div>
                                    <input type="range" id="triggerSlider" min="-30" max="0" value="0" step="1" oninput="Trading.updateTriggerSlider(this.value)" style="height:32px;">
                                </div>
                                <div class="slider-labels" style="margin-top:2px;" id="triggerLabels">
                                    <span id="triggerLabelMin">-30%</span>
                                    <span>0%</span>
                                </div>
                            </div>

                            <!-- Amount slider -->
                            <div>
                                <div style="font-size:11px;color:#64748b;margin-bottom:4px;text-align:center;" id="amountSliderLabel">Amount</div>
                                <div class="slider-box" style="height:32px;">
                                    <div class="slider-track"></div>
                                    <div class="slider-fill" id="triggerAmountFill" style="width:0%;background:#3b82f6;"></div>
                                    <input type="range" id="triggerAmountSlider" min="0" max="100" value="0" step="1" oninput="Trading.updateTriggerAmountSlider(this.value)" style="height:32px;">
                                </div>
                                <div class="slider-labels" style="margin-top:2px;">
                                    <span>0%</span>
                                    <span id="triggerAmountPercent">0%</span>
                                </div>
                            </div>

                        </div>

                        <!-- Amount display -->
                        <div style="text-align:center;margin-bottom:8px;">
                            <span style="font-size:13px;color:#94a3b8;" id="triggerAmountDisplay">$0.00</span>
                        </div>

                        <!-- Confirm button -->
                        <button class="confirm-limit-btn" style="margin-top:0;padding:12px;" id="confirmLimitBtn" onclick="Trading.showConfirmModal()">
                            <span id="confirmBtnText">Confirm Buy Trigger</span>
                        </button>

                    </div>

                    <div id="triggerError" class="error-message" style="display:none;margin-top:8px;"></div>
                </div>

                <!-- ═══ Pending Trigger Orders (under trigger section) ═══ -->
                <div class="pending-orders-section admin-only" id="pendingOrdersSection" style="margin-top:12px;">
                    <div class="pending-orders-header">
                        <div style="display:flex;align-items:center;gap:8px;">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            <span class="pending-orders-title">Pending Orders</span>
                            <span class="pending-orders-count" id="pendingOrdersCount">0</span>
                        </div>
                        <button class="pending-orders-refresh" onclick="API.fetchPendingOrders()" title="Refresh orders">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                                <path d="M21 3v5h-5"/>
                            </svg>
                        </button>
                    </div>
                    <div id="pendingOrdersList" class="pending-orders-list">
                        <div class="pending-orders-empty">No pending orders</div>
                    </div>
                </div>

                <!-- ═══ Auto Trading Section (inside trading panel) ═══ -->
                <div class="auto-compact admin-only" id="autoSection" style="display:none;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <span style="font-size:13px; font-weight:700; color:#a855f7;">Auto Trade</span>
                        <div id="autoStatusBadge" style="display:none; font-size:10px; font-weight:700; padding:3px 8px; border-radius:12px; background:rgba(168,85,247,0.2); color:#a855f7;">ACTIVE</div>
                    </div>

                    <!-- Horizontally scrollable tier cards (rendered by AutoTrader.renderTierCards) -->
                    <div id="tierCardsScroll" class="tier-cards-scroll"></div>

                    <!-- Error display -->
                    <div id="autoError" class="error-message" style="display:none; margin-bottom:8px;"></div>

                    <!-- Live status (monitoring) -->
                    <div id="autoStatus" style="display:none; padding:8px; border-radius:8px; margin-bottom:8px; font-size:10px; font-weight:500; background:rgba(168,85,247,0.1); color:#c4b5fd; line-height:1.4;"></div>

                    <!-- Trade Log -->
                    <div style="margin-bottom:8px; border-radius:8px; border:1px solid rgba(168,85,247,0.15); overflow:hidden;">
                        <div style="display:flex; justify-content:space-between; align-items:center; padding:6px 10px; background:rgba(168,85,247,0.08);">
                            <span style="font-size:10px; font-weight:700; color:#a855f7;">Trade Log</span>
                            <button onclick="AutoTrader.clearTradeLog()" style="font-size:9px; color:#64748b; background:none; border:none; cursor:pointer; padding:2px 6px;">Clear</button>
                        </div>
                        <div id="autoTradeLog" style="max-height:150px; overflow-y:auto;">
                            <div style="font-size:10px; color:#64748b; text-align:center; padding:12px;">No auto-trades yet. Trades will appear here when triggered.</div>
                        </div>
                    </div>
                </div>


            </div>
            
        </div>
    </div>

    <div class="holdings-container" id="holdingsContainer">
        <div class="holdings-header">
            <div style="display:flex;align-items:center;gap:6px;">
                <h2 class="text-lg font-bold holdings-title">Holdings</h2>
                <span id="holdingsCountdown" style="font-size:9px;font-weight:600;color:#94a3b8;background:rgba(255,255,255,0.08);padding:2px 7px;border-radius:8px;"></span>
            </div>

            <div style="display:flex;align-items:center;gap:6px;">
                <!-- Holdings toggle for users: Mine / Pool -->
                <div id="holdingsToggle" class="holdings-toggle user-only" style="display:none;">
                    <button id="btnMyHoldings" class="holdings-tab active" onclick="UI.setHoldingsView('mine')">Mine</button>
                    <button id="btnProjectHoldings" class="holdings-tab" onclick="UI.setHoldingsView('project')">Pool</button>
                </div>
                <button onclick="UI.toggleSort()" class="sort-btn">
                    <span id="currentSortLabel">Sort: Value</span>
                    <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="m6 9 6 6 6-6"/>
                    </svg>
                </button>
            </div>
        </div>

        <div id="holdings-list">
            <div style="text-align: center; color: #64748b; padding: 40px;">
                Connecting to Swyftx...
            </div>
        </div>

        <div class="last-updated" id="last-updated">Last updated: --</div>

        <div class="card admin-only" style="margin-top: 20px;">
            <div class="section-title">Activity Log</div>
            <div id="log-container" class="log-container">
                <div class="log-entry">
                    <span class="log-time">[--:--:--]</span>
                    <span class="log-info">Initializing...</span>
                </div>
            </div>
        </div>
    </div>

</div>

<div id="pinModal" class="pin-modal-overlay admin-only">
    <div class="pin-modal-content">
        <div class="pin-title">Trading PIN Required</div>
        <div class="pin-subtitle">Enter PIN to enable trading</div>
        <input type="password" id="pinInput" class="pin-input" maxlength="6" placeholder="••••••">
        <div id="pinError" class="pin-error">Invalid PIN</div>
        <button onclick="App.unlockTrading()" class="pin-btn" id="pinBtn">Unlock</button>
    </div>
</div>

<div id="limitConfirmModal" class="trade-modal-overlay">
    <div class="trade-modal-content">
        <div class="trade-modal-title" id="limitModalTitle">Confirm Limit Order</div>
        <div class="trade-modal-details">
            <div class="trade-detail-row">
                <span style="color: #64748b;">Type</span>
                <span id="limitModalType" style="color: white; font-weight: 600;">Buy Limit</span>
            </div>
            <div class="trade-detail-row">
                <span style="color: #64748b;">Asset</span>
                <span id="limitModalAsset" style="color: white;">BTC</span>
            </div>
            <div class="trade-detail-row">
                <span style="color: #64748b;">Trigger Price</span>
                <span id="limitModalTrigger" style="color: #a855f7;">$0.00</span>
            </div>
            <div class="trade-detail-row">
                <span style="color: #64748b;">Amount</span>
                <span id="limitModalAmount" style="color: white;">$0.00</span>
            </div>
            <div class="trade-detail-row">
                <span style="color: #64748b;">Receive</span>
                <span id="limitModalReceive" style="color: #22c55e;">0 BTC</span>
            </div>
        </div>
        <div class="trade-modal-buttons">
            <button onclick="Trading.closeLimitModal()" class="trade-modal-btn cancel">Cancel</button>
            <button onclick="Trading.executeLimitOrder()" class="trade-modal-btn confirm" id="limitModalExecuteBtn">Execute</button>
        </div>
    </div>
</div>

<div id="successModal" class="trade-modal-overlay">
    <div class="trade-modal-content" style="text-align: center;">
        <div style="width: 60px; height: 60px; background: #22c55e; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3">
                <path d="M20 6L9 17l-5-5"/>
            </svg>
        </div>
        <div class="trade-modal-title" style="color: #22c55e; margin-bottom: 8px;">Order Placed!</div>
        <p style="color: #94a3b8; font-size: 14px; margin-bottom: 20px;">Your limit order has been submitted successfully.</p>
        <button onclick="Trading.closeSuccessModal()" class="trade-modal-btn confirm" style="width: 100%;">Done</button>
    </div>
</div>

<div id="tradeModal" class="trade-modal-overlay">
    <div class="trade-modal-content">
        <div class="trade-modal-title" id="tradeModalTitle">Confirm Trade</div>
        <div class="trade-modal-details">
            <div class="trade-detail-row">
                <span style="color: #64748b;">Type</span>
                <span id="modalOrderType" style="color: white; font-weight: 600;">Instant</span>
            </div>
            <div class="trade-detail-row">
                <span style="color: #64748b;">Asset</span>
                <span id="modalAsset" style="color: white;">BTC</span>
            </div>
            <div class="trade-detail-row">
                <span style="color: #64748b;">Amount</span>
                <span id="modalAmount" style="color: white;">$0.00 USDC</span>
            </div>
            <div class="trade-detail-row" id="modalTriggerRow" style="display: none;">
                <span style="color: #64748b;">Trigger</span>
                <span id="modalTrigger" style="color: #a855f7;">$0.00</span>
            </div>
            <div class="trade-detail-row">
                <span style="color: #64748b;">Receive</span>
                <span id="modalReceive" style="color: #22c55e;">0 BTC</span>
            </div>
        </div>
        <div class="trade-modal-buttons">
            <button onclick="Trading.cancelTrade()" class="trade-modal-btn cancel">Cancel</button>
            <button onclick="Trading.confirmTrade()" class="trade-modal-btn confirm" id="modalConfirmBtn">Confirm</button>
        </div>
    </div>
</div>

<!-- Coin Selector Modal (TradingView-style) -->
<div class="coin-selector-overlay" id="coinSelectorOverlay" onclick="UI.closeCoinSelector()">
    <div class="coin-selector-modal" onclick="event.stopPropagation()">
        <div class="coin-selector-header">
            <span class="coin-selector-title">Select Symbol</span>
            <button class="coin-selector-close" onclick="UI.closeCoinSelector()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 6 6 18M6 6l12 12"/></svg>
            </button>
        </div>
        <div class="coin-selector-search">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <input type="text" id="coinSearchInput" placeholder="Search..." autocomplete="off" oninput="UI.filterCoinSelector(this.value)">
        </div>
        <div class="coin-selector-list" id="coinSelectorList"></div>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="UI.closeSort()"></div>
<div class="sort-modal" id="sortModal">
    <div class="flex justify-between items-center mb-4">
        <h3 class="font-bold text-base">Sort Holdings</h3>
        <button onclick="UI.closeSort()" class="p-2 rounded-lg hover:bg-slate-700">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 6 6 18M6 6l12 12"/>
            </svg>
        </button>
    </div>
    <div class="space-y-2">
        <button onclick="UI.selectSort('value')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-700 text-sm font-medium flex justify-between items-center" id="sort-value">
            <span>Value (High to Low)</span>
            <span id="check-value" class="text-blue-400">✓</span>
        </button>
        <button onclick="UI.selectSort('change')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-700 text-sm font-medium flex justify-between items-center" id="sort-change">
            <span>% Change (24h)</span>
            <span id="check-change" class="text-blue-400 hidden">✓</span>
        </button>
        <button onclick="UI.selectSort('name')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-700 text-sm font-medium flex justify-between items-center" id="sort-name">
            <span>Name (A-Z)</span>
            <span id="check-name" class="text-blue-400 hidden">✓</span>
        </button>
        <button onclick="UI.selectSort('balance')" class="w-full text-left px-4 py-3 rounded-lg hover:bg-slate-700 text-sm font-medium flex justify-between items-center" id="sort-balance">
            <span>Balance (High to Low)</span>
            <span id="check-balance" class="text-blue-400 hidden">✓</span>
        </button>
    </div>
</div>

<nav class="bottom-nav">
    <div class="flex justify-around items-center max-w-lg mx-auto">
        <a href="#" class="nav-item active">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="7" height="7" rx="1"/>
                <rect x="14" y="3" width="7" height="7" rx="1"/>
                <rect x="14" y="14" width="7" height="7" rx="1"/>
                <rect x="3" y="14" width="7" height="7" rx="1"/>
            </svg>
        </a>
        <a href="#" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 3v18h18"/>
                <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
            </svg>
        </a>
        <a href="#" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
        </a>
        <a href="#" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        </a>
        <a href="#" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
        </a>
    </div>
</nav>

<!-- Wallet Panel (slide-down when wallet button clicked while connected) -->
<div id="walletPanel" class="wallet-panel-overlay">
    <div class="wallet-panel-content">
        <div class="wallet-panel-header">
            <div style="display:flex;align-items:center;gap:8px;">
                <div class="wallet-panel-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                        <circle cx="12" cy="7" r="4"/>
                    </svg>
                </div>
                <div>
                    <div style="font-size:10px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;">Wallet</div>
                    <div id="walletPanelAddress" style="font-size:12px;color:#e2e8f0;font-weight:600;word-break:break-all;"></div>
                </div>
            </div>
            <span id="walletPanelRole" class="wallet-panel-role-badge user">User</span>
        </div>

        <!-- On-Chain Wallet Balances -->
        <div style="margin-bottom:12px;">
            <div style="font-size:10px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;">Wallet Balances</div>
            <div style="display:flex;gap:6px;">
                <div style="flex:1;padding:8px 6px;background:rgba(168,85,247,0.1);border-radius:10px;border:1px solid rgba(168,85,247,0.2);text-align:center;">
                    <div style="font-size:10px;color:#a855f7;font-weight:600;margin-bottom:4px;">SOL</div>
                    <div id="walletPanelSol" style="font-size:13px;font-weight:700;color:#e2e8f0;">0.0000</div>
                </div>
                <div style="flex:1;padding:8px 6px;background:rgba(34,197,94,0.1);border-radius:10px;border:1px solid rgba(34,197,94,0.2);text-align:center;">
                    <div style="font-size:10px;color:#22c55e;font-weight:600;margin-bottom:4px;">USDC</div>
                    <div id="walletPanelUsdc" style="font-size:13px;font-weight:700;color:#e2e8f0;">0.00</div>
                </div>
                <div style="flex:1;padding:8px 6px;background:rgba(236,72,153,0.1);border-radius:10px;border:1px solid rgba(236,72,153,0.2);text-align:center;">
                    <div style="font-size:10px;color:#ec4899;font-weight:600;margin-bottom:4px;">BUDJU</div>
                    <div id="walletPanelBudju" style="font-size:13px;font-weight:700;color:#e2e8f0;">0</div>
                </div>
            </div>
            <div id="budjuRequirement" style="display:none;margin-top:6px;padding:6px 10px;background:rgba(236,72,153,0.08);border:1px solid rgba(236,72,153,0.15);border-radius:8px;font-size:10px;color:#ec4899;text-align:center;">
                1,000,000 BUDJU required to use Flub (coming soon)
            </div>
        </div>

        <!-- Pool Stats -->
        <div class="wallet-panel-stats">
            <div style="font-size:10px;font-weight:600;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:2px;">Flub Pool</div>
            <div class="wallet-panel-stat">
                <span class="wallet-panel-stat-label">Pool Allocation</span>
                <span class="wallet-panel-stat-value" id="walletPanelAllocation">0%</span>
            </div>
            <div class="wallet-panel-stat">
                <span class="wallet-panel-stat-label">Total Deposited</span>
                <span class="wallet-panel-stat-value" id="walletPanelDeposited">$0.00</span>
            </div>
            <div class="wallet-panel-stat">
                <span class="wallet-panel-stat-label">Current Value</span>
                <span class="wallet-panel-stat-value" id="walletPanelValue">$0.00</span>
            </div>
        </div>

        <!-- User Holdings (their share of the pool) -->
        <div id="walletPanelHoldings" class="wallet-panel-holdings">
            <div style="font-size:12px;font-weight:600;color:#94a3b8;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Pool Holdings</div>
            <div id="walletPanelHoldingsList" style="font-size:12px;color:#64748b;">No holdings yet</div>
        </div>

        <!-- Deposit USDC button -->
        <button onclick="UI.showDepositModal()" class="wallet-panel-deposit-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 5v14M5 12h14"/>
            </svg>
            Deposit USDC
        </button>

        <!-- Disconnect button -->
        <button onclick="PhantomWallet.disconnect(); document.getElementById('walletPanel').classList.remove('show');" class="wallet-panel-disconnect-btn">
            Disconnect Wallet
        </button>
    </div>
</div>

<!-- Deposit USDC Modal -->
<div id="depositModal" class="trade-modal-overlay">
    <div class="trade-modal-content" style="text-align:center;">
        <div style="width:50px;height:50px;background:rgba(34,197,94,0.15);border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 12px;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2">
                <path d="M12 5v14M5 12h14"/>
            </svg>
        </div>
        <div class="trade-modal-title" style="color:#22c55e;">Deposit USDC</div>
        <p style="color:#94a3b8;font-size:13px;margin-bottom:12px;line-height:1.5;">
            Send USDC from your Phantom wallet to the Flub pool. Your allocation is based on your deposit percentage of the total pool.
        </p>
        <!-- Wallet USDC balance -->
        <div style="font-size:12px;color:#64748b;margin-bottom:12px;">
            Available: <span id="depositAvailableUsdc" style="color:#22c55e;font-weight:700;">0.00</span> USDC
        </div>
        <input type="number" id="depositAmount" placeholder="Amount (USDC)" style="width:100%;padding:14px;font-size:16px;text-align:center;background:rgba(0,0,0,0.3);border:2px solid rgba(255,255,255,0.1);border-radius:12px;color:white;margin-bottom:8px;" min="1" step="1">
        <!-- Deposit address -->
        <div style="font-size:10px;color:#64748b;margin-bottom:4px;">Sending to Flub Pool:</div>
        <div style="font-size:11px;color:#94a3b8;word-break:break-all;padding:8px;background:rgba(0,0,0,0.2);border-radius:8px;margin-bottom:12px;font-family:monospace;" id="depositAddressDisplay">
            2DfxgAZ655zkgt16r53e6qZ9Cf2Rse7iCGnypDk3nFhD
        </div>
        <div style="font-size:11px;color:#64748b;margin-bottom:16px;">Minimum deposit: $1 USDC</div>
        <!-- Loading spinner (hidden by default) -->
        <div id="depositLoading" style="display:none;padding:16px;text-align:center;">
            <div style="width:36px;height:36px;border:3px solid rgba(255,255,255,0.1);border-top-color:#22c55e;border-radius:50%;margin:0 auto 10px;animation:spin 0.8s linear infinite;"></div>
            <div style="font-size:13px;color:#94a3b8;">Waiting for Phantom approval...</div>
        </div>
        <div id="depositButtons" class="trade-modal-buttons">
            <button onclick="UI.closeDepositModal()" class="trade-modal-btn cancel">Cancel</button>
            <button onclick="UI.submitDeposit()" class="trade-modal-btn confirm" id="depositSendBtn" style="background:#22c55e;">Send USDC</button>
        </div>
    </div>
</div>

<!-- Phantom Install Modal -->
<div id="phantomInstallModal" class="trade-modal-overlay">
    <div class="trade-modal-content" style="text-align: center;">
        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #ab9ff2, #6e56cf); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px;">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        </div>
        <div class="trade-modal-title" style="color: #ab9ff2;">Phantom Wallet Required</div>
        <p style="color: #94a3b8; font-size: 14px; margin-bottom: 20px; line-height: 1.5;">
            To sign in and track your portfolio allocation, you need the Phantom wallet browser extension.
        </p>
        <a href="https://phantom.app/" target="_blank" rel="noopener noreferrer"
           style="display:block; width:100%; padding:14px; background:#ab9ff2; color:white; border:none; border-radius:10px; font-size:15px; font-weight:700; text-decoration:none; margin-bottom:10px;">
            Install Phantom
        </a>
        <button onclick="document.getElementById('phantomInstallModal').classList.remove('show')"
                class="trade-modal-btn cancel" style="width:100%;">
            Close
        </button>
    </div>
</div>

<!-- ═══ User Read-Only: Pending Orders Detail ═══ -->
<div id="userPendingModal" class="trade-modal-overlay">
    <div class="trade-modal-content" style="max-width:420px;max-height:80vh;overflow-y:auto;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <div style="display:flex;align-items:center;gap:8px;">
                <div style="width:32px;height:32px;border-radius:10px;background:rgba(168,85,247,0.15);display:flex;align-items:center;justify-content:center;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#a855f7" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                </div>
                <span style="font-size:16px;font-weight:700;color:#e2e8f0;">Pending Orders</span>
            </div>
            <button onclick="document.getElementById('userPendingModal').classList.remove('show')" style="width:28px;height:28px;border-radius:8px;background:rgba(255,255,255,0.06);border:none;color:#94a3b8;cursor:pointer;display:flex;align-items:center;justify-content:center;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg>
            </button>
        </div>
        <div style="font-size:11px;color:#64748b;margin-bottom:12px;padding:6px 10px;background:rgba(255,255,255,0.03);border-radius:8px;text-align:center;">View only — orders are managed by the pool admin</div>
        <div id="userPendingList" style="display:flex;flex-direction:column;gap:8px;">
            <div style="text-align:center;color:#64748b;font-size:12px;padding:20px;">No pending orders</div>
        </div>
    </div>
</div>

<!-- ═══ User Read-Only: Auto Trader Detail ═══ -->
<div id="userAutoTraderModal" class="trade-modal-overlay">
    <div class="trade-modal-content" style="max-width:420px;max-height:80vh;overflow-y:auto;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
            <div style="display:flex;align-items:center;gap:8px;">
                <div style="width:32px;height:32px;border-radius:10px;background:rgba(59,130,246,0.15);display:flex;align-items:center;justify-content:center;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" stroke-width="2"><path d="M12 2v4M12 18v4M2 12h4M18 12h4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg>
                </div>
                <span style="font-size:16px;font-weight:700;color:#e2e8f0;">Auto Trader</span>
                <span id="userBotBadge" style="display:none;font-size:10px;font-weight:700;padding:3px 8px;border-radius:12px;background:rgba(34,197,94,0.2);color:#22c55e;">ACTIVE</span>
            </div>
            <button onclick="UI.closeUserAutoTrader()" style="width:28px;height:28px;border-radius:8px;background:rgba(255,255,255,0.06);border:none;color:#94a3b8;cursor:pointer;display:flex;align-items:center;justify-content:center;">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18M6 6l12 12"/></svg>
            </button>
        </div>
        <div style="font-size:11px;color:#64748b;margin-bottom:12px;padding:6px 10px;background:rgba(255,255,255,0.03);border-radius:8px;text-align:center;">View only — the bot is managed by the pool admin</div>

        <!-- Bot settings summary -->
        <div id="userBotSettings" style="margin-bottom:12px;"></div>

        <!-- Coin monitoring -->
        <div id="userBotMonitor" style="margin-bottom:12px;"></div>

        <!-- Trade log -->
        <div style="border-radius:8px;border:1px solid rgba(59,130,246,0.15);overflow:hidden;">
            <div style="padding:6px 10px;background:rgba(59,130,246,0.08);font-size:10px;font-weight:700;color:#3b82f6;">Trade Log</div>
            <div id="userBotTradeLog" style="max-height:200px;overflow-y:auto;">
                <div style="font-size:10px;color:#64748b;text-align:center;padding:12px;">No auto-trades yet.</div>
            </div>
        </div>
    </div>
</div>

<script>
// Dynamic script loader — defeats Phantom/Safari aggressive caching
(function() {
    var t = Date.now();
    var scripts = [
        'js/config.js','js/logger.js','js/assets.js','js/price-animator.js',
        'js/api.js','js/phantom-wallet.js','js/ui.js','js/autotrader.js',
        'js/trading.js','js/server-state.js','js/app.js'
    ];
    scripts.forEach(function(src) {
        document.write('<script src="' + src + '?t=' + t + '"><\/script>');
    });
    console.log('FLUB v7.5 live-price-animation, built ' + new Date().toISOString());
})();
</script>
</body>
</html>
